<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Detail Alat</title>

  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <style>
    body {
      font-family: "Segoe UI", Arial, sans-serif;
      padding: 20px;
      background: #f3f4f6;
      margin: 0;
    }

    .card {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
      margin-bottom: 20px;
    }

    h2 {
      margin-top: 0;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
    }
    th, td {
      padding: 12px;
      border: 1px solid #e2e8f0;
      font-size: 14px;
    }
    th {
      background: #111827;
      color: white;
      font-weight: bold;
    }

    #qrcode {
      margin-top: 15px;
    }

    .loading {
      text-align: center;
      padding: 20px;
      font-size: 15px;
      color: #555;
    }
  </style>
</head>
<body>

<div class="card">
  <h2>Informasi Alat</h2>
  <p><strong>Serial Number:</strong> <span id="snText">Memuat...</span></p>
  <p><strong>Lokasi:</strong> <span id="locText">Memuat...</span></p>
  <div id="qrcode"></div>
</div>

<div class="card">
  <h2>Detail Alat</h2>
  <table>
    <tbody id="detailBody">
      <tr><td class="loading">Memuat data...</td></tr>
    </tbody>
  </table>
</div>

<div class="card">
  <h2>Log Maintenance</h2>
  <table>
    <thead>
      <tr>
        <th>Tanggal</th>
        <th>Kegiatan</th>
        <th>Teknisi</th>
      </tr>
    </thead>
    <tbody id="maintBody">
      <tr><td colspan="3" class="loading">Memuat data...</td></tr>
    </tbody>
  </table>
</div>

<div class="card">
  <h2>Log Calibration</h2>
  <table>
    <thead>
      <tr>
        <th>Tanggal</th>
        <th>Status</th>
        <th>Keterangan</th>
      </tr>
    </thead>
    <tbody id="calibBody">
      <tr><td colspan="3" class="loading">Memuat data...</td></tr>
    </tbody>
  </table>
</div>

<script>
const params = new URLSearchParams(window.location.search);
const SN = params.get("sn");
const LOC = params.get("loc");

document.getElementById("snText").textContent = SN || "Tidak ada";
document.getElementById("locText").textContent = LOC || "Tidak ada";

new QRCode(document.getElementById("qrcode"), {
  text: window.location.href,
  width: 120,
  height: 120,
});

// ==========================
// LINK GOOGLE SHEET PER LOKASI
// ==========================
const DETAIL_SHEET = {
  "22A3": "https://docs.google.com/spreadsheets/d/e/2PACX-1vQXfYx0A9EbttwdEODklcJe0pY3TGftGwwiqvqQswVczPXNPG3CS3Am7dYNXQVa_XSoJX3Pnd_B3AQI/pub?gid=0&single=true&output=csv",
  "27A6": "https://docs.google.com/spreadsheets/d/e/2PACX-1vQXfYx0A9EbttwdEODklcJe0pY3TGftGwwiqvqQswVczPXNPG3CS3Am7dYNXQVa_XSoJX3Pnd_B3AQI/pub?gid=143986787&single=true&output=csv",
};

function loadDetail() {
  Papa.parse(DETAIL_SHEET[LOC], {
    download: true,
    header: true,
    complete: function (results) {
      const row = results.data.find(r => r["Serial Number"] === SN);
      const tbody = document.getElementById("detailBody");
      tbody.innerHTML = "";

      if (!row) {
        tbody.innerHTML = `<tr><td>Data tidak ditemukan</td></tr>`;
        return;
      }

      Object.keys(row).forEach(k => {
        tbody.innerHTML += `
          <tr>
            <th>${k}</th>
            <td>${row[k] || "-"}</td>
          </tr>`;
      });
    }
  });
}

function loadMaintenance() {
  Papa.parse(`maintenance_${LOC}.csv`, {
    download: true,
    header: true,
    complete: function (results) {
      const data = results.data.filter(r => r["Serial"] === SN);
      const tbody = document.getElementById("maintBody");
      tbody.innerHTML = "";

      if (data.length === 0) {
        tbody.innerHTML = `<tr><td colspan="3">Tidak ada data</td></tr>`;
        return;
      }

      data.forEach(r => {
        tbody.innerHTML += `
          <tr>
            <td>${r["Tanggal"]}</td>
            <td>${r["Kegiatan"]}</td>
            <td>${r["Teknisi"]}</td>
          </tr>`;
      });
    }
  });
}

function loadCalibration() {
  Papa.parse(`calibration_${LOC}.csv`, {
    download: true,
    header: true,
    complete: function (results) {
      const data = results.data.filter(r => r["Serial"] === SN);
      const tbody = document.getElementById("calibBody");
      tbody.innerHTML = "";

      if (data.length === 0) {
        tbody.innerHTML = `<tr><td colspan="3">Tidak ada data</td></tr>`;
        return;
      }

      data.forEach(r => {
        tbody.innerHTML += `
          <tr>
            <td>${r["Tanggal"]}</td>
            <td>${r["Status"]}</td>
            <td>${r["Keterangan"]}</td>
          </tr>`;
      });
    }
  });
}

loadDetail();
loadMaintenance();
loadCalibration();
</script>

</body>
</html>
